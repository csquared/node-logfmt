#! /usr/bin/env node

var logfmt = require('../logfmt')
process.stdin.setEncoding('utf8');

var argv = process.argv.slice(2);
var data = '';
var last = null;
var println;

if(argv[0] == '-r'){
  //reverse -- convert json to logfmt logs
  println = function(line) {
    logfmt.log(JSON.parse(line.trim()))
  }
} else {
  //convert logfmt logs to json
  println = function(line) {
    console.log(JSON.stringify(logfmt.parse(line.trim())))
  }
}

process.stdin.on('data', function(chunk) {
  data = chunk.split("\n")
  if(last) println(last);
  data.slice(0,-1).forEach(function(line){
    println(line)
  })
  last = data[data.length]
})

process.stdin.on('end', function(){
  if(last) println(last);
  process.exit(0);
})

process.stdin.resume();
